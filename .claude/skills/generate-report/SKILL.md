# /generate-report

Generate a weekly markdown report aggregating all predictions for a gameweek.

## Usage
```
/generate-report [--gameweek GW25] [--season 2024-25]
```

Defaults: latest gameweek that has `predictions.json`.

## Prerequisites
- `predictions.json` must exist (from `/predict-matches`)
- Optionally: `results.json` and `evaluation.json` (for post-match reporting)

## Steps

### 1. Load Data
- Read `data/gameweeks/{season}/GW{n}/predictions.json`
- Read `data/gameweeks/{season}/GW{n}/results.json` (if exists — post-match)
- Read `data/gameweeks/{season}/GW{n}/evaluation.json` (if exists — post-match)
- Read `data/memory/performance-log.json` for cumulative stats

### 2. Generate Pre-Match Report
Write `data/gameweeks/{season}/GW{n}/report.md`:

```markdown
# Gameweek {n} Predictions Report
**Season**: {season} | **Generated**: {date} | **Matches**: {count}

---

## Premier League

| Home | Away | Prediction | Confidence | Score | Key Factor |
|------|------|------------|------------|-------|------------|
| Arsenal | Chelsea | H (52%) | 68% | 2-1 | Arsenal home form + Chelsea injuries |
| ... | ... | ... | ... | ... | ... |

## La Liga
...

## Bundesliga
...

## Serie A
...

## Ligue 1
...

---

## Confidence Distribution
- High confidence (>70%): {n} matches
- Medium confidence (50-70%): {n} matches
- Low confidence (<50%): {n} matches

## Key Narratives This Week
1. {narrative 1}
2. {narrative 2}
3. {narrative 3}

## Methodology
Predictions combine Elo ratings, Poisson goal models, and 5-signal qualitative
analysis (form, squad, tactical, market, narrative). See model components in
predictions.json for full breakdown.

---
*Generated by MyPredictify AI Pipeline. Not financial advice.*
```

### 3. Add Post-Match Analysis (if results exist)
If `results.json` and `evaluation.json` are present, append to the report:

```markdown
---

## Results & Accuracy

### Summary
| Metric | Value |
|--------|-------|
| Outcome Accuracy | {n}% ({correct}/{total}) |
| Score Accuracy | {n}% |
| Avg Log Loss | {n} |
| Brier Score | {n} |

### Biggest Misses
| Match | Predicted | Actual | Log Loss | Why |
|-------|-----------|--------|----------|-----|
| {match} | H (70%) | A (0-2) | 1.204 | {analysis} |

### Signal Performance
| Signal | Helped | Hurt | Net Impact |
|--------|--------|------|------------|
| Form | {n} | {n} | +{n}% |
| Squad | {n} | {n} | +{n}% |
| Tactical | {n} | {n} | -{n}% |
| Market | {n} | {n} | +{n}% |
| Narrative | {n} | {n} | +{n}% |

### Cumulative Season Accuracy
| Metric | This Week | Season Total |
|--------|-----------|--------------|
| Outcome Accuracy | {n}% | {n}% |
| Avg Log Loss | {n} | {n} |
| Total Predictions | {n} | {n} |
```

### 4. Error Handling
- If predictions.json is empty or invalid, report error in report and skip
- If results exist but evaluation doesn't, generate report without analysis section
- Always produce a valid markdown file even with partial data
- Log any issues to `_report-log.json`

### Output
- `data/gameweeks/{season}/GW{n}/report.md` — the full report
- `data/gameweeks/{season}/GW{n}/_report-log.json` — generation metadata
